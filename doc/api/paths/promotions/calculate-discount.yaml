post:
  tags:
    - Promotions
  summary: 割引計算
  description: |
    カート内の商品に対して適用可能なプロモーションを計算します。
  operationId: calculateDiscount
  security:
    - bearerAuth: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          required:
            - items
          properties:
            items:
              type: array
              description: カート内商品
              items:
                type: object
                required:
                  - skuId
                  - quantity
                  - unitPrice
                properties:
                  skuId:
                    type: string
                    example: "SKU-JACKET-M-BLACK"
                  quantity:
                    type: integer
                    example: 2
                  unitPrice:
                    type: number
                    format: decimal
                    example: 5000
            couponCode:
              type: string
              description: クーポンコード（オプション）
              example: "WELCOME10"
  responses:
    '200':
      description: 計算成功
      content:
        application/json:
          schema:
            type: object
            properties:
              subtotal:
                type: number
                format: decimal
                description: 小計
                example: 10000
              appliedPromotions:
                type: array
                description: 適用されたプロモーション
                items:
                  type: object
                  properties:
                    promotionId:
                      type: string
                      format: uuid
                      example: "aa0e8400-e29b-41d4-a716-446655440000"
                    name:
                      type: string
                      example: "ウィンターセール"
                    discountAmount:
                      type: number
                      format: decimal
                      example: 2000
              totalDiscount:
                type: number
                format: decimal
                description: 合計割引額
                example: 2000
              totalAmount:
                type: number
                format: decimal
                description: 割引後合計
                example: 8000
    '400':
      $ref: '../../components/responses/common.yaml#/BadRequest'
    '401':
      $ref: '../../components/responses/common.yaml#/Unauthorized'
    '500':
      $ref: '../../components/responses/common.yaml#/InternalServerError'
